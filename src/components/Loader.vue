<template>
    <div 
        class="container"
    >
        <div
            class="signs"
        >
            <svg 
                class="loader" 
                viewBox="0 0 41 20" 
                fill="none" 
                xmlns="http://www.w3.org/2000/svg"
                v-for="(elem, i) in signs"
                :key="i"
                :style="{ 
                    transform: 'translate(' + elem.transform.x + 'vw ,' + elem.transform.y + 'vh)' +
                        'scale(' + findScale(elem.transform.x, elem.transform.y) + ')' 
                }"
            >
                <path d="M 20.5 10 L 14.216 4.414 C 11.384 1.897 7.116 1.897 4.284 4.414 C 0.94 7.387 0.94 12.613 4.284 15.586 C 7.116 18.103 11.384 18.103 14.216 15.586 L 20.5 10 Z M 20.5 10 L 26.785 15.586 C 29.616 18.103 33.884 18.103 36.715 15.586 C 40.06 12.613 40.06 7.387 36.715 4.414 C 33.884 1.897 29.616 1.897 26.784 4.414 C 24.842 6.141 22.978 7.797 20.5 10 Z" stroke="black" stroke-width="2" stroke-dasharray="0 52 0">
                    <animate
                        :id="i" 
                        attributeName="stroke-dashoffset" 
                        values="0;104;"
                        :dur="duration"
                        :keySplines="elem.timeFunc"
                        calcMode="spline"
                    />
                    <animate
                        attributeName="stroke-width"
                        values="0;2;0"
                        :begin="i + '.begin'"
                        :end="i + '.end'"
                        :dur="duration"
                        keySplines=".25 .1 .25 1;
                                    .12 0 .39 0;"
                        calcMode="spline"
                    />
                </path>
            </svg>
            <svg 
                class="loader s" 
                viewBox="0 0 43 25" 
                fill="none" 
                xmlns="http://www.w3.org/2000/svg"
            >
                <path d="M1 2L17 18L24 2L40 18" stroke="black" stroke-width="2" stroke-dashoffset="32" stroke-dasharray="0 32">
                    <animate 
                        attributeName="stroke-dasharray" 
                        values="0 32;64 0;"
                        begin="0.end"
                        :dur="duration + 0.25" 
                        repeatCount="indefinite"
                        keySplines=".25 .1 .25 1;"
                        calcMode="spline"
                    />
                </path>                
            </svg>
            <svg 
                class="loader background" 
                viewBox="0 0 43 30" 
                fill="none" 
                xmlns="http://www.w3.org/2000/svg"
            >
                <path d="M 12.112 7.557 C 11.774 6.519 10.845 6.091 9.98 6.195 C 9.114 6.298 8.313 6.933 8.229 8.021 L 8.136 9.227 C 8.057 10.264 7.271 11.109 6.241 11.264 L 4.278 11.558 C 1.148 12.028 -0.644 15.381 0.703 18.244 C 0.828 18.511 0.954 18.777 1.079 19.044 C 1.67 20.299 2.723 21.278 4.018 21.776 C 5.101 22.193 6.184 22.609 7.267 23.026 C 8.023 23.317 8.551 24.009 8.631 24.815 C 8.796 26.456 10.672 27.306 12.014 26.347 C 12.797 25.787 13.581 25.228 14.364 24.668 C 15.388 23.937 16.707 23.757 17.889 24.187 C 18.986 24.586 20.082 24.984 21.179 25.383 C 21.392 25.461 21.614 25.514 21.839 25.542 C 23.734 25.779 25.373 24.225 25.237 22.32 C 25.228 22.2 25.22 22.08 25.211 21.96 C 25.091 20.273 26.255 18.765 27.916 18.453 C 28.274 18.386 28.631 18.319 28.989 18.252 C 31.271 17.824 32.865 15.746 32.687 13.431 C 32.642 12.841 32.596 12.252 32.551 11.662 C 32.517 11.225 32.571 10.786 32.71 10.371 C 33.508 7.978 31.422 5.616 28.949 6.11 C 28.837 6.132 28.726 6.155 28.614 6.177 C 27.592 6.382 26.532 6.117 25.726 5.457 L 25.726 5.457 C 24.817 4.713 23.908 3.97 22.998 3.226 L 20.271 0.995 C 18.564 -0.402 16 0.813 16 3.019 C 16 4.326 16 5.633 16 6.94 C 16 9.209 12.814 9.715 12.112 7.557" fill="black">
                    <animate 
                        attributeName="d" 
                        values="M 12.112 7.557 C 11.774 6.519 10.845 6.091 9.98 6.195 C 9.114 6.298 8.313 6.933 8.229 8.021 L 8.136 9.227 C 8.057 10.264 7.271 11.109 6.241 11.264 L 4.278 11.558 C 1.148 12.028 -0.644 15.381 0.703 18.244 C 0.828 18.511 0.954 18.777 1.079 19.044 C 1.67 20.299 2.723 21.278 4.018 21.776 C 5.101 22.193 6.184 22.609 7.267 23.026 C 8.023 23.317 8.551 24.009 8.631 24.815 C 8.796 26.456 10.672 27.306 12.014 26.347 C 12.797 25.787 13.581 25.228 14.364 24.668 C 15.388 23.937 16.707 23.757 17.889 24.187 C 18.986 24.586 20.082 24.984 21.179 25.383 C 21.392 25.461 21.614 25.514 21.839 25.542 C 23.734 25.779 25.373 24.225 25.237 22.32 C 25.228 22.2 25.22 22.08 25.211 21.96 C 25.091 20.273 26.255 18.765 27.916 18.453 C 28.274 18.386 28.631 18.319 28.989 18.252 C 31.271 17.824 32.865 15.746 32.687 13.431 C 32.642 12.841 32.596 12.252 32.551 11.662 C 32.517 11.225 32.571 10.786 32.71 10.371 C 33.508 7.978 31.422 5.616 28.949 6.11 C 28.837 6.132 28.726 6.155 28.614 6.177 C 27.592 6.382 26.532 6.117 25.726 5.457 L 25.726 5.457 C 24.817 4.713 23.908 3.97 22.998 3.226 L 20.271 0.995 C 18.564 -0.402 16 0.813 16 3.019 C 16 4.326 16 5.633 16 6.94 C 16 9.209 12.814 9.715 12.112 7.557;
                                M 11.531 0.908 C 11.211 0.877 10.891 0.847 10.571 0.816 C 6.871 0.464 4.248 4.346 5.956 7.648 L 7.146 9.949 C 8.22 12.024 6.713 14.5 4.376 14.5 L 2.966 14.5 C 0.945 14.5 -0.192 16.824 1.049 18.42 C 1.343 18.798 1.743 19.081 2.198 19.233 C 2.861 19.454 3.524 19.675 4.187 19.896 C 5.373 20.291 6.645 20.354 7.864 20.076 C 8.79 19.866 9.717 19.655 10.643 19.445 C 11.57 19.234 12.496 19.024 13.423 18.813 C 15.191 18.411 16.839 19.848 16.682 21.655 C 16.655 21.97 16.627 22.286 16.6 22.602 C 16.405 24.841 19.16 26.052 20.679 24.396 C 20.719 24.352 20.76 24.308 20.8 24.264 C 21.239 23.785 21.883 23.548 22.528 23.628 C 23.945 23.806 25.087 22.488 24.712 21.11 C 24.497 20.321 24.281 19.532 24.066 18.742 C 23.361 16.156 25.682 13.758 28.29 14.379 C 29.455 14.656 30.585 14.326 31.402 13.629 C 32.218 12.931 32.721 11.866 32.629 10.673 C 32.601 10.311 32.573 9.949 32.545 9.587 C 32.515 9.2 32.563 8.81 32.686 8.441 C 33.441 6.178 31.308 4.016 29.035 4.739 C 28.426 4.933 27.817 5.126 27.209 5.32 L 25.383 5.901 C 24.176 6.285 22.866 6.183 21.732 5.616 L 17.551 3.526 C 16.158 2.829 14.764 2.132 13.371 1.435 C 12.795 1.148 12.171 0.969 11.531 0.908 C 11.531 0.908 11.531 0.908 11.531 0.908;
                                M 12.112 7.557 C 11.774 6.519 10.845 6.091 9.98 6.195 C 9.114 6.298 8.313 6.933 8.229 8.021 L 8.136 9.227 C 8.057 10.264 7.271 11.109 6.241 11.264 L 4.278 11.558 C 1.148 12.028 -0.644 15.381 0.703 18.244 C 0.828 18.511 0.954 18.777 1.079 19.044 C 1.67 20.299 2.723 21.278 4.018 21.776 C 5.101 22.193 6.184 22.609 7.267 23.026 C 8.023 23.317 8.551 24.009 8.631 24.815 C 8.796 26.456 10.672 27.306 12.014 26.347 C 12.797 25.787 13.581 25.228 14.364 24.668 C 15.388 23.937 16.707 23.757 17.889 24.187 C 18.986 24.586 20.082 24.984 21.179 25.383 C 21.392 25.461 21.614 25.514 21.839 25.542 C 23.734 25.779 25.373 24.225 25.237 22.32 C 25.228 22.2 25.22 22.08 25.211 21.96 C 25.091 20.273 26.255 18.765 27.916 18.453 C 28.274 18.386 28.631 18.319 28.989 18.252 C 31.271 17.824 32.865 15.746 32.687 13.431 C 32.642 12.841 32.596 12.252 32.551 11.662 C 32.517 11.225 32.571 10.786 32.71 10.371 C 33.508 7.978 31.422 5.616 28.949 6.11 C 28.837 6.132 28.726 6.155 28.614 6.177 C 27.592 6.382 26.532 6.117 25.726 5.457 L 25.726 5.457 C 24.817 4.713 23.908 3.97 22.998 3.226 L 20.271 0.995 C 18.564 -0.402 16 0.813 16 3.019 C 16 4.326 16 5.633 16 6.94 C 16 9.209 12.814 9.715 12.112 7.557;"
                        begin="0.end + 1"
                        :dur="duration + 0.25" 
                        repeatCount="indefinite"
                        keySplines=".25 .1 .25 1;.25 .1 .25 1;"
                        calcMode="spline"
                    />
                </path>
            </svg>
        </div>
    </div>
</template>

<script>
export default {
    name: 'Loader',
    props: {
    },
    data() {
        return {
            duration: 0.75,

            signs: [                
                {
                    timeFunc: '.11 0 .5 0;',
                    transform: {
                        x: '0',
                        y: '0',  
                    }
                },
                {
                    timeFunc: '.45 0 .55 0;',
                    transform: {
                        x: '+35',
                        y: '-15',
                    }
                },
                {
                    timeFunc: '.25 .1 .25 1;',
                    transform: {
                        x: '20',
                        y: '15',
                    }
                },
                {
                    timeFunc: '.7 0 .84 0;',
                    transform: {
                        x: '-10',
                        y: '-35',
                    }
                },
                {
                    timeFunc: '.85 0 .15 0;',
                    transform: {
                        x: '-20',
                        y: '30', 
                    }
                },
                {
                    timeFunc: '.16 1 .3 1;',
                    transform: {
                        x: '-35',
                        y: '-15',
                    }
                },
            ]
        }
    },
    methods: {
        findScale(x,y) {
            const scale = 1 - (Math.abs(x) + Math.abs(y))/100;
            return scale;
        }
    }
}
</script>

<style scoped>
.container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
    position: absolute;
    top: 0;
    left: 0;
}

.signs {
    height: 15vh;
    width: 30.75vh;
}

.loader {
    position: absolute;
    height: 15vh;
    transition: transform 0.5s cubic-bezier(0.65, 0, 0.35, 1);
}

.s {   
    transform: rotateZ(-90deg);
}

.background {
    height: 100vh;
}
</style>
